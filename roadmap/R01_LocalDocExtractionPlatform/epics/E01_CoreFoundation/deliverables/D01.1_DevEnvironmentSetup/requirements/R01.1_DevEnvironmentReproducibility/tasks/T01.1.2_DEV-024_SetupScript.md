# T01.1.2 – Create scripts/setup.sh (Main Bootstrap Script)

## Task Context
**Assigned to:** DEV-024 (Deliverables Manager)  
**Associated Requirement:** R01.1 (Dev Environment Reproducibility)  
**Status:** Not Started  

## Task Statement
Create a bash script (`scripts/setup.sh`) that automates the entire development environment bootstrap process. The script must be idempotent, handle errors gracefully, and provide clear feedback at each step.

## Script Responsibilities
1. **Dependency Checks** – Verify Python 3.11+, bash, git, Docker
2. **Python venv Creation** – Create isolated environment
3. **Dependency Installation** – Run `pip install -r requirements.txt`
4. **Environment File** – Copy `.env.example` → `.env` (if not exists)
5. **PostgreSQL Setup** – Start Docker container, initialize schema
6. **Ollama Model** – Verify Mixtral 8x7b is downloaded
7. **Verification** – Run smoke tests to confirm everything works

## Script Features Required
- [ ] Shebang: `#!/bin/bash` with `set -e` for error handling
- [ ] Color-coded output (green for success, red for errors, yellow for warnings)
- [ ] Clear section headers ("=== Setting up Python venv ===")
- [ ] Idempotent – safe to run multiple times
- [ ] Detects and reports missing dependencies with fix suggestions
- [ ] Logs all steps to `setup.log` for debugging
- [ ] Provides rollback instructions if setup fails midway
- [ ] Handles interrupts gracefully (Ctrl+C)

## Pseudocode Structure
```bash
#!/bin/bash
set -e

log_info() { echo -e "\033[32m[INFO]\033[0m $1"; }
log_error() { echo -e "\033[31m[ERROR]\033[0m $1"; }
log_warn() { echo -e "\033[33m[WARN]\033[0m $1"; }

# 1. Check prerequisites (Python, bash, Docker)
# 2. Create venv if not exists: python3 -m venv venv
# 3. Activate venv: source venv/bin/activate
# 4. Upgrade pip: pip install --upgrade pip
# 5. Install requirements: pip install -r requirements.txt
# 6. Check PostgreSQL (docker-compose up -d)
# 7. Run migrations (alembic upgrade head)
# 8. Verify Ollama model (ollama list | grep mixtral)
# 9. Run smoke tests (pytest tests/test_setup.py -v)
# 10. Print summary and next steps
```

## Acceptance Criteria
- [ ] Script exists at `scripts/setup.sh` and is executable (`chmod +x`)
- [ ] Running `./scripts/setup.sh` on a clean clone completes in <30 minutes
- [ ] All dependency checks work and provide actionable error messages
- [ ] venv is created and dependencies are installed
- [ ] PostgreSQL container starts and is accessible
- [ ] Ollama model is verified present
- [ ] Smoke tests pass
- [ ] Script can be run multiple times without errors (idempotency)
- [ ] `setup.log` is created with full execution trace

## Definition of Done
- [ ] `scripts/setup.sh` created and committed
- [ ] Script tested on at least one fresh machine
- [ ] Execution time measured and <30 minutes confirmed
- [ ] Evidence: `setup.log` and test output saved to `evidence/T01.1.2_setup_execution.txt`
- [ ] DEV-024 confirms acceptance

## Related Tasks
- Depends on T01.1.1 (requirements.txt must exist)
- Blocks T01.1.4 (onboarding docs will reference this script)
- Enables T01.1.5 (script testing)
