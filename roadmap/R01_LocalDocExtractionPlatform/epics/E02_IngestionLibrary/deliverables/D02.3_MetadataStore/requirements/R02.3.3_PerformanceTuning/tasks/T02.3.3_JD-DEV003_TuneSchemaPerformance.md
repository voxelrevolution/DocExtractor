# Task Specification: T02.3.3_JD-DEV033_TuneSchemaPerformance

**Assigned To:** DEV-033 (SQL Performance Engineer)  
**Epic:** E02  
**Deliverable:** D02.3 – Metadata Storage  
**Estimated Effort:** 5 hours  
**Blocking Task:** T02.3.2 (migrations)

---

## Objective

Optimize schema performance: analyse queries, add indices, benchmark against key access patterns, ensure < 100ms for common queries.

---

## Acceptance Criteria

1. ✅ **Query Performance** – Key queries < 100ms on 1M documents
2. ✅ **Index Coverage** – All high-frequency queries have covering indices
3. ✅ **Analyse Results** – ANALYSE (SQLite VACUUM ANALYSE) run
4. ✅ **Benchmarks** – Measured on test hardware
5. ✅ **Optimization Plan** – Future optimizations documented

---

## Key Queries to Optimize

1. **Find by hash (duplicate check)** – O(1) with index
   - SELECT * FROM hash_index WHERE sha256_hash = ?
   - Target: < 10ms

2. **Find documents by type** – O(log n) with index
   - SELECT * FROM documents WHERE document_type = ?
   - Target: < 50ms for 1M documents

3. **Recent imports** – O(log n) with index
   - SELECT * FROM documents WHERE import_date > ? ORDER BY import_date DESC LIMIT 100
   - Target: < 50ms

4. **All documents** – O(n), pagination required
   - SELECT * FROM documents LIMIT 1000 OFFSET ?
   - Target: < 100ms per page

---

## Indices to Add/Verify

- [ ] hash_index.sha256_hash (UNIQUE, for dedup)
- [ ] documents.document_type (for filtering)
- [ ] documents.import_date (for sorting)
- [ ] audit_log.timestamp (for recent events)

---

## Evidence Artifacts

- [ ] **Index Plan** – T02.3.3_JD-DEV033_IndexPlan.md
- [ ] **Query Plans** – T02.3.3_JD-DEV033_QueryPlans.md
- [ ] **Benchmarks** – T02.3.3_JD-DEV033_PerformanceBenchmarks.md
- [ ] **EXPLAIN Analysis** – T02.3.3_JD-DEV033_ExplainAnalysis.md
- [ ] **Tuning Report** – T02.3.3_JD-DEV033_TuningReport.md
- [ ] **QC-101 Sign-Off** – T02.3.3_JD-QC101_SignOff.md

---

## How to Start

1. **Create Test Database** (1 hour)
   - [ ] Apply migrations from T02.3.2
   - [ ] Load test data (1000 documents, then 1M simulated)
   - [ ] Populate with realistic data

2. **Analyse Current Performance** (1 hour)
   - [ ] EXPLAIN QUERY PLAN for key queries
   - [ ] Identify full table scans, missing indices
   - [ ] Benchmark: measure time per query

3. **Add Indices** (1 hour)
   - [ ] Create index on hash_index.sha256_hash
   - [ ] Create index on documents.document_type
   - [ ] Create index on documents.import_date

4. **Reanalyse** (1 hour)
   - [ ] ANALYSE database
   - [ ] EXPLAIN QUERY PLAN again
   - [ ] Benchmark again (should be faster)

5. **Document Results** (1 hour)
   - [ ] Performance report
   - [ ] Before/after comparisons
   - [ ] Future optimization opportunities

---

## Completion

**Performance Tuning Complete When:**
- ✅ All key queries < 100ms
- ✅ All high-frequency queries have indices
- ✅ Benchmarks documented
- ✅ All 6 artifacts created
- ✅ QC-101 approved

---

**Document Status:** Created 2026-01-14, Owner: DEV-033, Complete D02.3
