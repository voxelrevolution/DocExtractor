# T01.1.3 â€“ Create docker-compose.yml for PostgreSQL

## Task Context
**Assigned to:** DEV-003 (Database Developer)  
**Associated Requirement:** R01.1 (Dev Environment Reproducibility)  
**Status:** Not Started  
**JD Reference:** `/Setup/fiab/agents/job_descriptions/DEV-003_Database_Developer.json`

## Task Statement
Create a `docker-compose.yml` file that defines a local PostgreSQL 15+ service with pgvector extension, proper initialization scripts, and health checks. This ensures all developers have an identical database environment.

## Compose Services
### PostgreSQL Service
- Image: `postgres:15-alpine`
- Environment:
  - `POSTGRES_USER=docextractor`
  - `POSTGRES_PASSWORD=dev_password` (safe for local dev only)
  - `POSTGRES_DB=docextractor_dev`
- Ports: `5432:5432` (localhost access)
- Volumes:
  - `./data/postgres:/var/lib/postgresql/data` (persistent storage)
  - `./scripts/init_postgres.sql:/docker-entrypoint-initdb.d/init.sql` (init script)
- Health Check: `pg_isready -U docextractor`
- Networks: `docextractor-network`

### pgvector Extension
- Install via init script: `CREATE EXTENSION IF NOT EXISTS vector;`

## Compose Features
- [ ] Services defined with explicit versions (no `latest`)
- [ ] Health checks configured for PostgreSQL
- [ ] Volumes for data persistence
- [ ] Environment variables externalizable (use `.env`)
- [ ] Network created for service isolation
- [ ] Comments explaining each section

## Initialization Script (init_postgres.sql)
Create `scripts/init_postgres.sql` that:
- Creates pgvector extension
- Creates initial schemas (documents, extractions, annotations tables)
- Creates indexes for performance
- Sets up initial users/roles if needed

## Acceptance Criteria
- [ ] `docker-compose.yml` exists and is valid YAML
- [ ] `docker-compose up -d` starts PostgreSQL successfully
- [ ] PostgreSQL is accessible on `localhost:5432` from host
- [ ] pgvector extension is loaded and verified
- [ ] Health check shows container as healthy
- [ ] Data persists across container restarts
- [ ] `docker-compose down` cleans up properly

## Definition of Done
- [ ] `docker-compose.yml` created and committed
- [ ] `scripts/init_postgres.sql` created with schema definitions
- [ ] Tested: `docker-compose up -d && psql -U docextractor -d docextractor_dev -h localhost`
- [ ] Evidence: PostgreSQL connection test output saved to `evidence/T01.1.3_postgres_test.txt`
- [ ] DEV-024 confirms acceptance

## Related Tasks
- Works in parallel with T01.1.2 (setup script will call `docker-compose up`)
- Enables T01.1.5 (integration testing)
