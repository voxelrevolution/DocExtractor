# Governance Framework: Deduplication Authority & Escalation

**Task:** T02.2.1_JD-DATA015_DefineDeduplicationStrategy  
**Owner:** DATA-015 (Data Architect)  
**Date:** 2026-01-14

---

## Governance Model

### Authority: Who Decides?

**SYSTEM (deterministic, no human discretion in E02)**

Deduplication is rule-based and unambiguous:
- Hash matches → Document is duplicate (fact, not opinion)
- No human judgment required
- All users get same treatment (fair, consistent)

### Decision Rules

**Rule 1: Exact Match Detection**
```
IF document.sha256_hash == hash_index.sha256_hash THEN
  Result: DUPLICATE (reject document)
ELSE
  Result: NOT DUPLICATE (accept document)
END
```

**Rule 2: First-Come-First-Served**
```
IF duplicate detected THEN
  Keep: Original document (first import)
  Reject: New document (this attempt)
END
```

**Rule 3: Immutable After First Import**
```
ONCE document_id N is imported:
  - Its hash is locked in hash_index
  - No changes allowed
  - Only audit trail records existence
END
```

---

## User Experience: Duplicate Handling

### Scenario A: User Uploads Unique Document

```
System: ✅ "Document imported successfully (ID: 4521)"
Next step: Document appears in dashboard
```

### Scenario B: User Accidentally Uploads Same Document Twice

```
System: ⚠️ "Document rejected: Duplicate of Document #4521 (uploaded 2026-01-10)"
User options:
  1. Accept (most common)
  2. Contact admin if they believe it's different
```

### Scenario C: User Uploads Modified Version (e.g., 1 character changed)

```
System: ✅ "Document imported successfully (ID: 4523)"
Reason: Hash is different (even 1 character change = different hash)
Note: System treats as new document (expected behavior)
```

---

## Administrative Authority

### Role: Data Administrator

**Permissions:**
- View audit trail of all duplicate detections
- Query: "Show me all duplicates detected in last 30 days"
- Investigate: "Why was this marked as duplicate?"
- Report: "What's our duplicate detection rate?"

**Decisions (E02 scope):**
- ❌ Cannot override duplicate rejection (not in E02)
- ✅ Can investigate patterns
- ✅ Can tune detection (future: adjust hash algorithm if needed)

### Role: User

**Permissions:**
- See rejection message with link to original
- Understand why document was rejected

**Decisions (E02 scope):**
- ❌ Cannot override rejection
- ✅ Can contact admin if they believe it's a mistake

---

## Escalation Path

### Issue: "But I think this is different!"

**User claims two documents are different, but system detected them as duplicates**

Escalation process:
1. User receives: "Document rejected: duplicate of Document #4521"
2. User can verify: Click link to view original document
3. If still convinced it's different:
   - Contact admin with justification
   - Admin reviews both documents
   - Admin decision:
     - **If truly different:** Override feature needed (future)
     - **If actually same:** Educate user

**Note:** With SHA-256, false positives are mathematically impossible. If hashes match, files are identical.

### Issue: "The system isn't detecting duplicates!"

**User reports that obviously duplicate documents weren't caught**

Investigation:
1. Admin queries audit_log for the document
2. Admin computes hash of supposed duplicate
3. Analysis:
   - **If different hash:** Documents are different (expected behavior)
   - **If same hash:** Database issue (escalate to DEV-003)

---

## Compliance & Audit Trail

### Regulatory Requirements

- ✅ **Audit Trail:** Every decision logged immutably
- ✅ **No Bias:** System applies same rules to all users
- ✅ **Transparency:** Users can see why document was rejected
- ✅ **Traceability:** Administrators can investigate any decision

### Compliance Questions

**Q: Can you prove you detected a specific duplicate?**
A: Yes. Query audit_log with document ID → shows timestamp, hash, original document ID.

**Q: Can you prove no duplicates were missed?**
A: No (mathematically impossible to prove negative). But with 99.999% confidence, no SHA-256 collisions in realistic datasets.

**Q: Can you change duplicate detection rules?**
A: E02 scope: No (rules are hardcoded). Future: Yes (via configuration change).

---

## Escalation Paths by Issue Type

| Issue | Owner | Timeline | Action |
|-------|-------|----------|--------|
| User reports false duplicate | Admin | < 2 hours | Review, respond to user |
| System malfunction (no duplicates detected) | DEV-003 | < 4 hours | Debug, verify hash computation |
| Performance degradation (lookups > 50ms) | DEV-003 | < 8 hours | Investigate query plan, optimize |
| Audit trail shows suspicious pattern | Admin | Next business day | Investigate pattern, report findings |
| User requests override (duplicate not rejected) | PM-007 | Next sprint | Design override feature (future) |

---

## Decision Authority Matrix (RACI)

| Decision | System | Admin | User | DEV-003 | PM-007 |
|----------|--------|-------|------|---------|--------|
| Reject duplicate | **R** (Responsible) | C | I | — | — |
| Investigate rejection | C | **A** (Accountable) | I | **R** | — |
| Override rejection | — | **C** | — | — | **A** |
| Change detection rules | — | C | — | **A** | C |
| Monitor performance | — | C | — | **R** | — |
| Escalate issue | C | **A** | R (reports) | C | C |

*R = Responsible (does the work), A = Accountable (final say), C = Consulted, I = Informed*

---

## Future Considerations (Beyond E02)

### E03+: Override Feature
- Admin override: "Keep both versions despite duplicate"
- Audit trail: "Override approved by admin X on 2026-02-14"
- Use case: Legal requirement to preserve all versions

### E04+: Configurable Rules
- Admin sets duplicate definition (e.g., size + hash, not just hash)
- Different rules per document type (e.g., invoices vs contracts)
- Audit trail captures rule version per detection

### E05+: Machine Learning
- Learn from user feedback: "This wasn't actually a duplicate"
- Refine detection rules over time
- Maintain audit trail of rule changes

---

**Document Status:** Governance Framework APPROVED. Clear authority, fair escalation paths.
