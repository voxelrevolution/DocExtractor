# Evidence — T02.1.3_JD-DEV024_StrictClientSelectionContract

**Date:** 2026-01-19  
**Owner (JD):** DEV-024 (Document Importer / Tooling)

## Summary

Implemented and validated a strict client-selection contract for ingestion flows.

When known clients exist and an ingestion request cannot be confidently auto-assigned to a single client, the backend blocks ingestion with an explicit HTTP 409 error payload (`client_id_required`). Downstream ingestion tooling (batch ingest CLI) handles this by prompting once for a client selection and retrying the upload with an explicit `client_id`.

## Contract

- Backend response: HTTP `409`
- Error key: `detail.error == "client_id_required"`
- Payload includes `detail.client_resolution` (candidate assessment) to support human-in-the-loop selection.

## Artifacts

- Backend strict enforcement: `src/main.py`
- Client registry and resolution:
  - `src/clients/registry.py`
  - `src/clients/resolution.py`
  - `src/schemas/clients.py`
- Batch ingestion tooling (prompt + retry): `scripts/batch_ingest.py`
- Coverage:
  - Backend API tests: `tests/test_clients_api.py`
  - Batch ingest CLI test: `tests/test_batch_ingest.py`

## Validation

- ✅ Backend test suite: `66 passed`
  - Captured output: `evidence/E04/test_runs/2026-01-19_pytest_full.txt`

## Notes

This evidence item documents post-E02 hardening work applied to the ingestion toolchain to enforce client scoping and eliminate cross-client mixing risk.
